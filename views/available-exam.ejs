<%- include('./layouts/header') %>
  <!--begin::Body-->

  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <!--begin::App Wrapper-->
    <div class="app-wrapper">
      <%- include('./layouts/navbar-sidebar') %>
        <!--begin::App Main-->
        <main class="app-main">
          <!--begin::App Content Header-->
          <div class="app-content-header">
            <!--begin::Container-->
            <div class="container-fluid">
              <!--begin::Row-->
              <div class="row">
                <div class="col-sm-6">
                  <h3 class="mb-0">Available Exams</h3>
                </div>
              </div>
              <!--end::Row-->
            </div>
            <!--end::Container-->
          </div>
          <!--end::App Content Header-->
          <!--begin::App Content-->
          <div class="app-content">
            <!--begin::Container-->
            <div class="container-fluid">

              <div class="container mt-5">

                <div class="row justify-content-center g-4">
                  <% if(exams.length>0){ %>

                    <% exams.forEach((exam)=>{
                      %>
                      <div class="col-md-6 col-lg-4">
                        <div class="card exam-card shadow-sm h-100">
                          <div class="card-body">
                            <h5 class="card-title">
                              <%=exam.title %>
                            </h5>
                            <p class="card-text">
                              <%=exam.description%>
                            </p>
                            <ul class="list-unstyled mb-3">
                              <li><strong>Start Date & Time:</strong>
                                <%
                                function showCustomdate(date) {
                                    const day = String(date.getDate()).padStart(2, '0');
                                    const month = String(date.getMonth() + 1).padStart(2, '0');
                                    const year = date.getFullYear();
                                    const time = date.toLocaleTimeString();
                                    return `${day}-${month}-${year}, ${time}`;
                                }
                                %>
                                <%=showCustomdate(new Date(exam.startTime))%>
                              </li>
                              <li><strong>Duration:</strong>
                                <%=exam.duration %> mins
                              </li>

                            </ul>
                            <button class="btn btn-primary w-100 start-btn" data-start="<%= new Date(exam.startTime)%>"
                              data-duration="<%=exam.duration %>" onclick="gotoExamPage('<%=exam._id %>')"><i
                                class="bi bi-file-lock"></i></button>
                          </div>
                        </div>
                      </div>
                      <% }) }else{ %>
                        <div class="col-md-6 col-lg-4">
                          <div
                            class="card no-exam-card text-center shadow-sm h-100 d-flex align-items-center justify-content-center p-4">
                            <!-- <i class="bi bi-exclamation-circle-fill" style="font-size: 50px; color: #f0ad4e;"></i> -->
                            <h5 class="mt-3">No Exam Available</h5>
                            <p class="text-muted">Currently, there are no exams available to take. Please check back
                              later.</p>
                          </div>
                        </div>

                        <% } %>
                </div>
              </div>






            </div>
            <!--end::Container-->
          </div>
          <!--end::App Content-->
        </main>
        <!--end::App Main-->

        <%- include('./layouts/footer') %>

          <script>

            function updateStartExam() {
              $('.start-btn').each(function () {
                const startBtn = $(this);
                const startTime = new Date(startBtn.data('start'));
                const now = new Date();

                if (now >= startTime) {
                  startBtn.removeClass('btn-primary').addClass('btn-success');
                  startBtn.prop('disabled', false);
                  startBtn.html('Start Exam');
                } else {
                  startBtn.removeClass('btn-success').addClass('btn-primary');
                  startBtn.prop('disabled', true);
                  startBtn.html('<i class="bi bi-file-lock"></i>');
                }
              });
            }


            function gotoExamPage(id) {
              window.location.href = '/student/take-exam/' + id;
            }


            updateStartExam();

            setInterval(updateStartExam, 5000);

          </script>

  </body>
  <!--end::Body-->

  </html>